---
description: GraphRAG（グラフラグ）の意味と仕組み。ナレッジグラフで関係性を活かす RAG と、従来の RAG との違いをまとめます。
tags:
  - RAG
  - GraphRAG
  - LLM
  - ナレッジグラフ
---

# GraphRAG（グラフラグ）とは

GraphRAG は **Graph Retrieval-Augmented Generation** の略で、マイクロソフトリサーチが 2024 年 2 月に発表した技術です。**ナレッジグラフ（知識グラフ）を活用して、情報同士の関連性を強化した RAG** で、従来のベクトル検索ベースの RAG とはデータの持ち方と検索の仕方が大きく異なります。

---

## 意味と定義

- **RAG（Retrieval-Augmented Generation）**: 外部の文書を検索して得た情報を LLM のコンテキストに載せ、根拠付きの回答を生成する手法。
- **GraphRAG**: 文書を「テキストの塊」ではなく **エンティティ（人・組織・概念など）とその関係** としてグラフで持ち、そのグラフをたどって検索・要約し、その結果で LLM に回答を生成させる方式。

つまり「グラフを使った RAG」＝グラフで検索（Retrieval）し、その結果で生成（Generation）を補強する、という意味で「グラフラグ」と呼ばれます。

---

## 従来の RAG との違い

| 観点 | 従来の RAG | GraphRAG |
|------|------------|----------|
| **データ構造** | テキストをチャンク分割し、ベクトル DB に格納 | エンティティと関係を抽出し、グラフ DB（ノード・エッジ）に格納 |
| **検索方式** | クエリとのベクトル類似度でチャンクを取得 | グラフ上でノード間のパスやコミュニティを辿る検索 |
| **扱える質問** | 単語・文の意味が近い部分の抜き出しに強い | 「A が所属する組織 B の動向」など、**関係性に沿った** 質問に強い |

従来の RAG は「似た表現のテキスト」を取ってきますが、GraphRAG は「誰が誰とどう関係しているか」をグラフで持っているため、**多段階の関係**（A → B → C）を考慮した検索や、**コミュニティ単位の要約** を利用した回答がしやすくなります。

---

## 仕組みの概要

GraphRAG はおおまかに **インデックス作成** と **クエリ処理** の 2 フェーズで動きます。

### インデックス作成フェーズ

1. **テキストの分割**: 元の文書を小さなチャンクに分割する。
2. **エンティティ・関係の抽出**: LLM で各チャンクから「エンティティ」と「エンティティ間の関係」を抽出し、ノードとエッジからなる **ナレッジグラフ** を構築する。
3. **コミュニティ検出**: グラフ上で関連の強いノードをグループ化（コミュニティ化）する。
4. **コミュニティ要約**: 各コミュニティごとに LLM で要約文を生成し、グローバルな検索用の情報として持っておく。

### クエリ処理フェーズ

- **グローバル検索**: データセット全体の傾向や概要を聞く質問（例：「全体でよく出てくるテーマは？」）には、コミュニティ要約を参照する。
- **ローカル検索**: 特定のエンティティや事柄の詳細を聞く質問（例：「〇〇氏の役職は？」）には、そのノード周辺のパスや関係をたどってコンテキストを組み立てる。

必要に応じて、ベクトル検索やキーワード検索と **ハイブリッド** で組み合わせる運用も可能です。

---

## メリット

- **関係性を活かした一貫した回答**: 単なる類似テキストの羅列ではなく、「誰が何をした」「どの組織とどうつながっているか」をグラフで追えるため、矛盾や抜けが減りやすい。
- **複雑な関係・多段階推論**: 「A の上司である B が所属する C 部門」のように、複数ホップの関係を扱いやすい。
- **グローバルとローカルの使い分け**: 全体像を聞く質問と、特定トピックの深掘りの両方に、同じグラフから対応できる。

---

## 注意点・デメリット

- **構築コスト**: グラフの作成・更新に LLM 呼び出しとグラフ処理が必要で、従来の RAG よりインデックス作成のコストがかかりやすい。
- **スケール**: 文書量やエンティティ数が非常に多い場合、グラフのサイズや検索時間の設計が重要になる。
- **適したユースケース**: 「関係性が重要なドメイン」（組織図、事件・人物の関係、技術・製品の依存関係など）で特に効果が大きい。

---

## まとめ

**グラフラグ（GraphRAG）** は、RAG の「検索」部分を **ナレッジグラフ** で行う方式です。「グラフラグの意味」は、**「グラフを用いた検索で LLM の生成を補強する」** と押さえておくとよいでしょう。従来の RAG と組み合わせたり、関係性が重要なドキュメントや FAQ に適用したりする選択肢として知っておくと便利です。

---

## 参考リンク

- [Microsoft Research - From Local to Global: A Graph RAG Approach](https://www.microsoft.com/en-us/research/blog/graphrag-unlocking-llm-discovery-on-narrative-private-data/)
- [IBM - GraphRAGとは](https://www.ibm.com/jp-ja/think/topics/graphrag)
- [KDDI 用語集 - GraphRAG](https://biz.kddi.com/content/glossary/g/graphrag)
